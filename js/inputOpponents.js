import { EventEmitter, shuffle } from './core.js';
const parentSelector = '#inputnames';
const inputAreaPlc = 'Input name';
const inputAreaCN = 'opponents__input';
const _inputArea = `<input type="text" class="${inputAreaCN}" placegolder="${inputAreaPlc}">`;
const itemNameCN = 'opponents-item__name';
const _itemName = `<span class="${itemNameCN}"></span>`;
const itemRemoveCN = 'opponents-item__Remove';
const _itemRemove = `<span class="${itemRemoveCN}">[X]</span>`;
const itemCN = 'opponents-item';
const _item = `<div class="${itemCN}">${_itemName}${_itemRemove}</div>`;
const itemListCN = 'opponents-list';
const _itemList = `<div class="${itemListCN}"></div>`;
const inputWrapCN = 'opponents';
const _inputWrap = `<div class="${inputWrapCN}"></div>`;
class OpponentsModel extends EventEmitter {
    constructor() {
        super(...arguments);
        this.players = [];
        this.result = [];
    }
    addName(name) {
        this.players.push(name);
    }
    removeName(name) {
        const index = this.players.indexOf(name);
        this.players.splice(index, 1);
    }
}
class OpponentsView extends EventEmitter {
    constructor(model) {
        super();
        this.elements = {
            $wrap: $(_inputWrap),
            $list: $(_itemList),
            $input: $(_inputArea)
        };
        this._model = model;
        this.elements.$input.on('keydown', event => this.emit('inputHandler', event));
        this.elements.$list.on('click', `.${itemRemoveCN}`, event => this.emit('removeItem', this.getItemText(event.target)));
    }
    getItemText(elem) {
        return $(elem).closest(`.${itemCN}`).find(`.${itemNameCN}`).text();
    }
    clearInput() {
        this.elements.$input.val('');
    }
    addItemElem(name) {
        const $item = $(_item);
        const $name = $item.find(`.${itemNameCN}`);
        $name.text(name);
        this.elements.$list.append($item);
    }
    removeItemElem(name) {
        const $list = this.elements.$list;
        const $target = $list.find(`*:contains('${name}')`);
        $target.remove();
    }
    render() {
        const $parent = $(parentSelector);
        const $wrap = this.elements.$wrap;
        const $list = this.elements.$list;
        const $input = this.elements.$input;
        $wrap.append($list).append($input).appendTo($parent);
    }
}
class OpponentsController {
    constructor(model, view) {
        this._model = model;
        this._view = view;
        view.on('addItem', (name) => this.addItem(name));
        view.on('removeItem', (name) => this.removeItem(name));
        view.on('inputHandler', (event) => this.inputHandler(event));
    }
    inputHandler(event) {
        const key = event.key;
        const keyCode = event.keyCode;
        const value = event.target.value;
        if (key == 'Enter' || keyCode == 13) {
            this.addItem(value);
            this._view.clearInput();
        }
    }
    addItem(name) {
        this._model.addName(name);
        this._view.addItemElem(name);
    }
    removeItem(name) {
        this._model.removeName(name);
        this._view.removeItemElem(name);
    }
    shuffle() {
        const shuffled = shuffle(this._model.players);
        const left = makeMatchup(shuffled);
        const right = makeMatchup(shuffled.concat(shuffled.splice(0, shuffled.length - 1)));
        function makeMatchup(names) {
            let temp = [];
            let group = [];
            names.forEach((el, i) => {
                temp.push(el);
                if (temp.length == 2) {
                    group.push(temp.map(n => n));
                    temp = [];
                }
            });
            return group;
        }
        return { left, right };
    }
}
export class Opponents {
    constructor() {
        this.model = new OpponentsModel();
        this.view = new OpponentsView(this.model);
        this.controller = new OpponentsController(this.model, this.view);
        this.view.render();
        this.controller.addItem('dima');
        this.controller.addItem('sanya');
        this.controller.addItem('igor');
        this.controller.addItem('makc');
        this.controller.addItem('katya');
        this.controller.addItem('polina');
        this.controller.addItem('nataha');
        this.controller.addItem('pati');
    }
    getPlayers() {
        return this.model.players.map(n => n);
    }
    shuffle() {
        return this.controller.shuffle();
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QyxVQUFVLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxVQUFVO1FBQ04sT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQsT0FBTztRQUNILE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNyQyxDQUFDO0NBQ0oiLCJmaWxlIjoiaW5wdXRPcHBvbmVudHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEVtaXR0ZXIsIHNodWZmbGUgfSBmcm9tICcuL2NvcmUuanMnO1xyXG5cclxuY29uc3QgcGFyZW50U2VsZWN0b3IgPSAnI2lucHV0bmFtZXMnO1xyXG5cclxuY29uc3QgaW5wdXRBcmVhUGxjID0gJ0lucHV0IG5hbWUnO1xyXG5jb25zdCBpbnB1dEFyZWFDTiA9ICdvcHBvbmVudHNfX2lucHV0JztcclxuY29uc3QgX2lucHV0QXJlYSA9IGA8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cIiR7aW5wdXRBcmVhQ059XCIgcGxhY2Vnb2xkZXI9XCIke2lucHV0QXJlYVBsY31cIj5gO1xyXG5cclxuY29uc3QgaXRlbU5hbWVDTiA9ICdvcHBvbmVudHMtaXRlbV9fbmFtZSc7XHJcbmNvbnN0IF9pdGVtTmFtZSA9IGA8c3BhbiBjbGFzcz1cIiR7aXRlbU5hbWVDTn1cIj48L3NwYW4+YDtcclxuXHJcbmNvbnN0IGl0ZW1SZW1vdmVDTiA9ICdvcHBvbmVudHMtaXRlbV9fUmVtb3ZlJztcclxuY29uc3QgX2l0ZW1SZW1vdmUgPSBgPHNwYW4gY2xhc3M9XCIke2l0ZW1SZW1vdmVDTn1cIj5bWF08L3NwYW4+YDtcclxuXHJcbmNvbnN0IGl0ZW1DTiA9ICdvcHBvbmVudHMtaXRlbSc7XHJcbmNvbnN0IF9pdGVtID0gYDxkaXYgY2xhc3M9XCIke2l0ZW1DTn1cIj4ke19pdGVtTmFtZX0ke19pdGVtUmVtb3ZlfTwvZGl2PmA7XHJcblxyXG5jb25zdCBpdGVtTGlzdENOID0gJ29wcG9uZW50cy1saXN0JztcclxuY29uc3QgX2l0ZW1MaXN0ID0gYDxkaXYgY2xhc3M9XCIke2l0ZW1MaXN0Q059XCI+PC9kaXY+YDtcclxuXHJcbmNvbnN0IGlucHV0V3JhcENOID0gJ29wcG9uZW50cyc7XHJcbmNvbnN0IF9pbnB1dFdyYXAgPSBgPGRpdiBjbGFzcz1cIiR7aW5wdXRXcmFwQ059XCI+PC9kaXY+YDtcclxuXHJcblxyXG5jbGFzcyBPcHBvbmVudHNNb2RlbCBleHRlbmRzIEV2ZW50RW1pdHRlciB7XHJcbiAgICBwbGF5ZXJzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgcmVzdWx0OiBBcnJheTxbc3RyaW5nLCBzdHJpbmddPiA9IFtdO1xyXG5cclxuICAgIGFkZE5hbWUobmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5wbGF5ZXJzLnB1c2gobmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlTmFtZShuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMucGxheWVycy5pbmRleE9mKG5hbWUpO1xyXG5cclxuICAgICAgICB0aGlzLnBsYXllcnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgT3Bwb25lbnRzVmlldyBleHRlbmRzIEV2ZW50RW1pdHRlciB7XHJcbiAgICBfbW9kZWw6IE9wcG9uZW50c01vZGVsO1xyXG5cclxuICAgIGVsZW1lbnRzID0ge1xyXG4gICAgICAgICR3cmFwOiAkKF9pbnB1dFdyYXApLFxyXG4gICAgICAgICRsaXN0OiAkKF9pdGVtTGlzdCksXHJcbiAgICAgICAgJGlucHV0OiAkKF9pbnB1dEFyZWEpXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG1vZGVsOiBPcHBvbmVudHNNb2RlbCkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcblxyXG4gICAgICAgIHRoaXMuX21vZGVsID0gbW9kZWw7XHJcblxyXG4gICAgICAgIHRoaXMuZWxlbWVudHMuJGlucHV0Lm9uKCdrZXlkb3duJywgZXZlbnQgPT4gdGhpcy5lbWl0KCdpbnB1dEhhbmRsZXInLCBldmVudCkpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudHMuJGxpc3Qub24oJ2NsaWNrJywgYC4ke2l0ZW1SZW1vdmVDTn1gLCBldmVudCA9PiB0aGlzLmVtaXQoJ3JlbW92ZUl0ZW0nLCB0aGlzLmdldEl0ZW1UZXh0KGV2ZW50LnRhcmdldCkpKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRJdGVtVGV4dChlbGVtOiBIVE1MRWxlbWVudCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuICQoZWxlbSkuY2xvc2VzdChgLiR7aXRlbUNOfWApLmZpbmQoYC4ke2l0ZW1OYW1lQ059YCkudGV4dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFySW5wdXQoKSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50cy4kaW5wdXQudmFsKCcnKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRJdGVtRWxlbShuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCAkaXRlbSA9ICQoX2l0ZW0pO1xyXG4gICAgICAgIGNvbnN0ICRuYW1lID0gJGl0ZW0uZmluZChgLiR7aXRlbU5hbWVDTn1gKTtcclxuXHJcbiAgICAgICAgJG5hbWUudGV4dChuYW1lKTtcclxuXHJcbiAgICAgICAgdGhpcy5lbGVtZW50cy4kbGlzdC5hcHBlbmQoJGl0ZW0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUl0ZW1FbGVtKG5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0ICRsaXN0ID0gdGhpcy5lbGVtZW50cy4kbGlzdDtcclxuICAgICAgICBjb25zdCAkdGFyZ2V0ID0gJGxpc3QuZmluZChgKjpjb250YWlucygnJHtuYW1lfScpYCk7XHJcblxyXG4gICAgICAgICR0YXJnZXQucmVtb3ZlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyKCkge1xyXG4gICAgICAgIGNvbnN0ICRwYXJlbnQgPSAkKHBhcmVudFNlbGVjdG9yKTtcclxuICAgICAgICBjb25zdCAkd3JhcCA9IHRoaXMuZWxlbWVudHMuJHdyYXA7XHJcbiAgICAgICAgY29uc3QgJGxpc3QgPSB0aGlzLmVsZW1lbnRzLiRsaXN0O1xyXG4gICAgICAgIGNvbnN0ICRpbnB1dCA9IHRoaXMuZWxlbWVudHMuJGlucHV0O1xyXG5cclxuICAgICAgICAkd3JhcC5hcHBlbmQoJGxpc3QpLmFwcGVuZCgkaW5wdXQpLmFwcGVuZFRvKCRwYXJlbnQpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBPcHBvbmVudHNDb250cm9sbGVyIHtcclxuICAgIF9tb2RlbDogT3Bwb25lbnRzTW9kZWw7XHJcbiAgICBfdmlldzogT3Bwb25lbnRzVmlldztcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihtb2RlbDogT3Bwb25lbnRzTW9kZWwsIHZpZXc6IE9wcG9uZW50c1ZpZXcpIHtcclxuICAgICAgICB0aGlzLl9tb2RlbCA9IG1vZGVsO1xyXG4gICAgICAgIHRoaXMuX3ZpZXcgPSB2aWV3O1xyXG5cclxuICAgICAgICB2aWV3Lm9uKCdhZGRJdGVtJywgKG5hbWU6IHN0cmluZykgPT4gdGhpcy5hZGRJdGVtKG5hbWUpKTtcclxuICAgICAgICB2aWV3Lm9uKCdyZW1vdmVJdGVtJywgKG5hbWU6IHN0cmluZykgPT4gdGhpcy5yZW1vdmVJdGVtKG5hbWUpKTtcclxuICAgICAgICB2aWV3Lm9uKCdpbnB1dEhhbmRsZXInLCAoZXZlbnQpID0+IHRoaXMuaW5wdXRIYW5kbGVyKGV2ZW50KSk7XHJcbiAgICB9XHJcblxyXG4gICAgaW5wdXRIYW5kbGVyKGV2ZW50KSB7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gZXZlbnQua2V5O1xyXG4gICAgICAgIGNvbnN0IGtleUNvZGUgPSBldmVudC5rZXlDb2RlO1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xyXG5cclxuICAgICAgICBpZiAoa2V5ID09ICdFbnRlcicgfHwga2V5Q29kZSA9PSAxMykge1xyXG4gICAgICAgICAgICB0aGlzLmFkZEl0ZW0odmFsdWUpO1xyXG4gICAgICAgICAgICB0aGlzLl92aWV3LmNsZWFySW5wdXQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYWRkSXRlbShuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl9tb2RlbC5hZGROYW1lKG5hbWUpO1xyXG4gICAgICAgIHRoaXMuX3ZpZXcuYWRkSXRlbUVsZW0obmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlSXRlbShuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl9tb2RlbC5yZW1vdmVOYW1lKG5hbWUpO1xyXG4gICAgICAgIHRoaXMuX3ZpZXcucmVtb3ZlSXRlbUVsZW0obmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2h1ZmZsZSgpOiB7bGVmdDogQXJyYXk8W3N0cmluZywgc3RyaW5nXT4sIHJpZ2h0OiBBcnJheTxbc3RyaW5nLCBzdHJpbmddPn0ge1xyXG4gICAgICAgIGNvbnN0IHNodWZmbGVkID0gc2h1ZmZsZSh0aGlzLl9tb2RlbC5wbGF5ZXJzKTtcclxuICAgICAgICBjb25zdCBsZWZ0ID0gbWFrZU1hdGNodXAoc2h1ZmZsZWQpO1xyXG4gICAgICAgIGNvbnN0IHJpZ2h0ID0gbWFrZU1hdGNodXAoIHNodWZmbGVkLmNvbmNhdCggc2h1ZmZsZWQuc3BsaWNlKDAsIHNodWZmbGVkLmxlbmd0aCAtIDEpICkgKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbWFrZU1hdGNodXAobmFtZXM6IHN0cmluZ1tdKSB7XHJcbiAgICAgICAgICAgIGxldCB0ZW1wID0gW107XHJcbiAgICAgICAgICAgIGxldCBncm91cCA9IFtdO1xyXG5cclxuICAgICAgICAgICAgbmFtZXMuZm9yRWFjaCgoZWwsIGkpID0+IHtcclxuICAgICAgICAgICAgICAgIHRlbXAucHVzaChlbCk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICh0ZW1wLmxlbmd0aCA9PSAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXAucHVzaCh0ZW1wLm1hcChuID0+IG4pKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wID0gW107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGdyb3VwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtsZWZ0LCByaWdodH07XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBPcHBvbmVudHMgeyBcclxuICAgIG1vZGVsOiBPcHBvbmVudHNNb2RlbDtcclxuICAgIHZpZXc6IE9wcG9uZW50c1ZpZXc7XHJcbiAgICBjb250cm9sbGVyOiBPcHBvbmVudHNDb250cm9sbGVyO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMubW9kZWwgICAgICA9IG5ldyBPcHBvbmVudHNNb2RlbCgpO1xyXG4gICAgICAgIHRoaXMudmlldyAgICAgICA9IG5ldyBPcHBvbmVudHNWaWV3KHRoaXMubW9kZWwpO1xyXG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IG5ldyBPcHBvbmVudHNDb250cm9sbGVyKHRoaXMubW9kZWwsIHRoaXMudmlldyk7XHJcblxyXG4gICAgICAgIHRoaXMudmlldy5yZW5kZXIoKTtcclxuXHJcbiAgICAgICAgdGhpcy5jb250cm9sbGVyLmFkZEl0ZW0oJ2RpbWEnKTtcclxuICAgICAgICB0aGlzLmNvbnRyb2xsZXIuYWRkSXRlbSgnc2FueWEnKTtcclxuICAgICAgICB0aGlzLmNvbnRyb2xsZXIuYWRkSXRlbSgnaWdvcicpO1xyXG4gICAgICAgIHRoaXMuY29udHJvbGxlci5hZGRJdGVtKCdtYWtjJyk7XHJcbiAgICAgICAgdGhpcy5jb250cm9sbGVyLmFkZEl0ZW0oJ2thdHlhJyk7XHJcbiAgICAgICAgdGhpcy5jb250cm9sbGVyLmFkZEl0ZW0oJ3BvbGluYScpO1xyXG4gICAgICAgIHRoaXMuY29udHJvbGxlci5hZGRJdGVtKCduYXRhaGEnKTtcclxuICAgICAgICB0aGlzLmNvbnRyb2xsZXIuYWRkSXRlbSgncGF0aScpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFBsYXllcnMoKTogc3RyaW5nW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm1vZGVsLnBsYXllcnMubWFwKG4gPT4gbik7XHJcbiAgICB9XHJcblxyXG4gICAgc2h1ZmZsZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb250cm9sbGVyLnNodWZmbGUoKTtcclxuICAgIH1cclxufSJdfQ==
