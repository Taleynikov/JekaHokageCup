import { EventEmitter } from './core.js';
import { HEROES } from './heroes.js';
const colSymbol = 'abcdefghijklmnop';
const rowCount = 7;
let parentSelector = '#grid';
const gridCN = 'heroes-grid';
const _grid = `<div class="${gridCN}"></div>`;
const gridWrapCN = 'heroes-grid-wrap';
const _gridWrap = `<div class="${gridWrapCN}"></div>`;
const rowCN = 'heroes-grid__row';
const _row = `<div class="${rowCN}"></div>`;
const colCN = 'heroes-grid__col';
const colTargetHeroCN = 'heroes-grid__col_hover';
const colTargetSymbolCN = 'heroes-grid__col_target';
const _col = `<div class="${colCN}"></div>`;
const symbolCN = 'heroes-grid__symbol';
const _symbol = `<div class="${symbolCN}"></div>`;
const imgWrapCN = 'heroes-grid__hero';
const _imgWrap = `<div class="${imgWrapCN}"></div>`;
const imgCN = 'heroes-grid__hero-img';
const _img = `<img class="${imgCN}">`;
class HeroesGridModel extends EventEmitter {
    constructor() {
        super(...arguments);
        this.heroes = HEROES;
    }
    getHero(id) {
        return this.heroes.find(hero => hero.id == id);
    }
}
class HeroesGridView extends EventEmitter {
    constructor(model) {
        super();
        this.elem = {
            $wrap: $(parentSelector),
            $grid: $(_grid)
        };
        this._model = model;
        this.elem.$grid
            .on('mouseenter', `.${colCN}`, event => this.setTarget(event.currentTarget))
            .on('mouseleave', event => this.setTarget(null))
            .on('click', `.${colCN}[data-id]`, event => this.emit('click', {
            hero: this._model.getHero($(event.currentTarget).attr('data-id')),
            event
        }));
    }
    setTarget(elem) {
        const $target = $(`.${colCN}`);
        const id = $(elem).attr('data-id');
        $target.removeClass(`${colTargetHeroCN} ${colTargetSymbolCN}`);
        if (id) {
            const [col, row] = id.split('');
            const $hero = $target.filter(`[data-id="${id}"]`);
            const $symbol = $target.filter(`[data-target="${col}"], [data-target="${row}"]`);
            $hero.addClass(colTargetHeroCN);
            $symbol.addClass(colTargetSymbolCN);
        }
    }
    createSymbol(text) {
        const $symbol = $(_symbol);
        $symbol.text(text);
        return $symbol;
    }
    createHeroImage(hero) {
        const $imgWrap = $(_imgWrap);
        const $img = $(_img);
        $img.attr({
            src: hero.thumb,
            alt: hero.name
        });
        $imgWrap.append($img);
        return $imgWrap;
    }
    initGrid() {
        const $wrap = this.elem.$wrap;
        const $grid = this.elem.$grid;
        const $gridWrap = $(_gridWrap);
        $gridWrap.append($grid).appendTo($wrap);
        for (let i = -1; i <= rowCount; i++) {
            const $row = $(_row);
            for (let j = -1; j <= colSymbol.length; j++) {
                const $col = $(_col);
                if (i == -1 || i == rowCount) {
                    $col.attr('data-target', colSymbol[j]);
                    $col.append(this.createSymbol(colSymbol[j]));
                }
                else {
                    if (j == -1 || j == colSymbol.length) {
                        $col.attr('data-target', i + 1);
                        $col.append(this.createSymbol(i + 1));
                    }
                    else {
                        const hero = this._model.getHero(colSymbol[j] + (i + 1));
                        const $img = this.createHeroImage(hero);
                        $col.attr('data-id', hero.id);
                        $col.append($img);
                    }
                }
                $row.append($col);
            }
            $grid.append($row);
        }
    }
    render() {
        this.initGrid();
    }
}
class HeroesGridController {
    constructor(model, view) {
        this._model = model;
        this._view = view;
        view.on('click', (info) => this.click(info));
    }
}
export class HeroesGrid {
    constructor(gridOpt) {
        this.model = new HeroesGridModel();
        this.view = new HeroesGridView(this.model);
        this.controller = new HeroesGridController(this.model, this.view);
        if (gridOpt) {
            if (gridOpt.parent)
                parentSelector = gridOpt.parent;
        }
        this.view.render();
    }
    on(event, callback) {
        this.controller[event] = callback;
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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Q0FBQyxNQUFNO2dCQUFFLGNBQWMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDO1NBQ3ZEO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUN2QixDQUFDO0lBRUQsRUFBRSxDQUFDLEtBQWEsRUFBRSxRQUFrQjtRQUNoQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFHLFFBQVEsQ0FBQztJQUN0QyxDQUFDO0NBQ0oiLCJmaWxlIjoiaGVyb2VzR3JpZC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJy4vY29yZS5qcyc7XHJcbmltcG9ydCB7IEhFUk9FUyB9IGZyb20gJy4vaGVyb2VzLmpzJztcclxuaW1wb3J0IHsgSGVybywgR3JpZE9wdGlvbnMgfSBmcm9tICcuL3R5cGVzJztcclxuXHJcbmNvbnN0IGNvbFN5bWJvbCA9ICdhYmNkZWZnaGlqa2xtbm9wJztcclxuY29uc3Qgcm93Q291bnQgPSA3O1xyXG5cclxubGV0IHBhcmVudFNlbGVjdG9yID0gJyNncmlkJztcclxuXHJcbmNvbnN0IGdyaWRDTiA9ICdoZXJvZXMtZ3JpZCc7XHJcbmNvbnN0IF9ncmlkID0gYDxkaXYgY2xhc3M9XCIke2dyaWRDTn1cIj48L2Rpdj5gO1xyXG5cclxuY29uc3QgZ3JpZFdyYXBDTiA9ICdoZXJvZXMtZ3JpZC13cmFwJztcclxuY29uc3QgX2dyaWRXcmFwID0gYDxkaXYgY2xhc3M9XCIke2dyaWRXcmFwQ059XCI+PC9kaXY+YDtcclxuXHJcbmNvbnN0IHJvd0NOID0gJ2hlcm9lcy1ncmlkX19yb3cnO1xyXG5jb25zdCBfcm93ID0gYDxkaXYgY2xhc3M9XCIke3Jvd0NOfVwiPjwvZGl2PmA7XHJcblxyXG5jb25zdCBjb2xDTiA9ICdoZXJvZXMtZ3JpZF9fY29sJztcclxuY29uc3QgY29sVGFyZ2V0SGVyb0NOID0gJ2hlcm9lcy1ncmlkX19jb2xfaG92ZXInO1xyXG5jb25zdCBjb2xUYXJnZXRTeW1ib2xDTiA9ICdoZXJvZXMtZ3JpZF9fY29sX3RhcmdldCc7XHJcbmNvbnN0IF9jb2wgPSBgPGRpdiBjbGFzcz1cIiR7Y29sQ059XCI+PC9kaXY+YDtcclxuXHJcbmNvbnN0IHN5bWJvbENOID0gJ2hlcm9lcy1ncmlkX19zeW1ib2wnO1xyXG5jb25zdCBfc3ltYm9sID0gYDxkaXYgY2xhc3M9XCIke3N5bWJvbENOfVwiPjwvZGl2PmA7XHJcblxyXG5jb25zdCBpbWdXcmFwQ04gPSAnaGVyb2VzLWdyaWRfX2hlcm8nO1xyXG5jb25zdCBfaW1nV3JhcCA9IGA8ZGl2IGNsYXNzPVwiJHtpbWdXcmFwQ059XCI+PC9kaXY+YDtcclxuXHJcbmNvbnN0IGltZ0NOID0gJ2hlcm9lcy1ncmlkX19oZXJvLWltZyc7XHJcbmNvbnN0IF9pbWcgPSBgPGltZyBjbGFzcz1cIiR7aW1nQ059XCI+YDtcclxuXHJcblxyXG5jbGFzcyBIZXJvZXNHcmlkTW9kZWwgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xyXG4gICAgaGVyb2VzOiBIZXJvW10gPSBIRVJPRVM7XHJcblxyXG4gICAgZ2V0SGVybyhpZDogc3RyaW5nKTogSGVybyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaGVyb2VzLmZpbmQoaGVybyA9PiBoZXJvLmlkID09IGlkKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgSGVyb2VzR3JpZFZpZXcgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xyXG4gICAgX21vZGVsOiBIZXJvZXNHcmlkTW9kZWw7XHJcblxyXG4gICAgZWxlbSA9IHtcclxuICAgICAgICAkd3JhcDogJChwYXJlbnRTZWxlY3RvciksXHJcbiAgICAgICAgJGdyaWQ6ICQoX2dyaWQpXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG1vZGVsOiBIZXJvZXNHcmlkTW9kZWwpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG5cclxuICAgICAgICB0aGlzLl9tb2RlbCA9IG1vZGVsO1xyXG5cclxuICAgICAgICB0aGlzLmVsZW0uJGdyaWRcclxuICAgICAgICAgICAgLm9uKCdtb3VzZWVudGVyJywgYC4ke2NvbENOfWAsIGV2ZW50ID0+IHRoaXMuc2V0VGFyZ2V0KGV2ZW50LmN1cnJlbnRUYXJnZXQpKVxyXG4gICAgICAgICAgICAub24oJ21vdXNlbGVhdmUnLCBldmVudCA9PiB0aGlzLnNldFRhcmdldChudWxsKSlcclxuICAgICAgICAgICAgLm9uKCdjbGljaycsIGAuJHtjb2xDTn1bZGF0YS1pZF1gLCBldmVudCA9PiB0aGlzLmVtaXQoJ2NsaWNrJywge1xyXG4gICAgICAgICAgICAgICAgaGVybzogdGhpcy5fbW9kZWwuZ2V0SGVybyggJChldmVudC5jdXJyZW50VGFyZ2V0KS5hdHRyKCdkYXRhLWlkJykgKSxcclxuICAgICAgICAgICAgICAgIGV2ZW50XHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRUYXJnZXQoZWxlbTogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICBjb25zdCAkdGFyZ2V0ID0gJChgLiR7Y29sQ059YCk7XHJcbiAgICAgICAgY29uc3QgaWQgPSAkKGVsZW0pLmF0dHIoJ2RhdGEtaWQnKTtcclxuXHJcbiAgICAgICAgJHRhcmdldC5yZW1vdmVDbGFzcyhgJHtjb2xUYXJnZXRIZXJvQ059ICR7Y29sVGFyZ2V0U3ltYm9sQ059YCk7XHJcblxyXG4gICAgICAgIGlmIChpZCkge1xyXG4gICAgICAgICAgICBjb25zdCBbY29sLCByb3ddID0gaWQuc3BsaXQoJycpO1xyXG4gICAgICAgICAgICBjb25zdCAkaGVybyA9ICR0YXJnZXQuZmlsdGVyKGBbZGF0YS1pZD1cIiR7aWR9XCJdYCk7XHJcbiAgICAgICAgICAgIGNvbnN0ICRzeW1ib2wgPSAkdGFyZ2V0LmZpbHRlcihgW2RhdGEtdGFyZ2V0PVwiJHtjb2x9XCJdLCBbZGF0YS10YXJnZXQ9XCIke3Jvd31cIl1gKTtcclxuXHJcbiAgICAgICAgICAgICRoZXJvLmFkZENsYXNzKGNvbFRhcmdldEhlcm9DTik7XHJcbiAgICAgICAgICAgICRzeW1ib2wuYWRkQ2xhc3MoY29sVGFyZ2V0U3ltYm9sQ04pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVTeW1ib2wodGV4dDogc3RyaW5nIHwgbnVtYmVyKTogSlF1ZXJ5IHtcclxuICAgICAgICBjb25zdCAkc3ltYm9sID0gJChfc3ltYm9sKTtcclxuICAgICAgICAkc3ltYm9sLnRleHQodGV4dCk7XHJcblxyXG4gICAgICAgIHJldHVybiAkc3ltYm9sO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUhlcm9JbWFnZShoZXJvOiBIZXJvKTogSlF1ZXJ5IHtcclxuICAgICAgICBjb25zdCAkaW1nV3JhcCA9ICQoX2ltZ1dyYXApO1xyXG4gICAgICAgIGNvbnN0ICRpbWcgPSAkKF9pbWcpO1xyXG5cclxuICAgICAgICAkaW1nLmF0dHIoe1xyXG4gICAgICAgICAgICBzcmM6IGhlcm8udGh1bWIsXHJcbiAgICAgICAgICAgIGFsdDogaGVyby5uYW1lXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRpbWdXcmFwLmFwcGVuZCgkaW1nKTtcclxuXHJcbiAgICAgICAgcmV0dXJuICRpbWdXcmFwO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXRHcmlkKCkge1xyXG4gICAgICAgIGNvbnN0ICR3cmFwID0gdGhpcy5lbGVtLiR3cmFwO1xyXG4gICAgICAgIGNvbnN0ICRncmlkID0gdGhpcy5lbGVtLiRncmlkO1xyXG4gICAgICAgIGNvbnN0ICRncmlkV3JhcCA9ICQoX2dyaWRXcmFwKTtcclxuXHJcbiAgICAgICAgJGdyaWRXcmFwLmFwcGVuZCgkZ3JpZCkuYXBwZW5kVG8oJHdyYXApO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gLTE7IGkgPD0gcm93Q291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCAkcm93ID0gJChfcm93KTtcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAtMTsgaiA8PSBjb2xTeW1ib2wubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0ICRjb2wgPSAkKF9jb2wpO1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKGkgPT0gLTEgfHwgaSA9PSByb3dDb3VudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRjb2wuYXR0cignZGF0YS10YXJnZXQnLCBjb2xTeW1ib2xbal0pO1xyXG4gICAgICAgICAgICAgICAgICAgICRjb2wuYXBwZW5kKCB0aGlzLmNyZWF0ZVN5bWJvbCggY29sU3ltYm9sW2pdICkgKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGogPT0gLTEgfHwgaiA9PSBjb2xTeW1ib2wubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb2wuYXR0cignZGF0YS10YXJnZXQnLCBpICsgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb2wuYXBwZW5kKCB0aGlzLmNyZWF0ZVN5bWJvbCggaSArIDEgKSApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhlcm8gPSB0aGlzLl9tb2RlbC5nZXRIZXJvKGNvbFN5bWJvbFtqXSArIChpICsgMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCAkaW1nID0gdGhpcy5jcmVhdGVIZXJvSW1hZ2UoaGVybyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkY29sLmF0dHIoJ2RhdGEtaWQnLCBoZXJvLmlkKTtcclxuICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGNvbC5hcHBlbmQoJGltZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICRyb3cuYXBwZW5kKCRjb2wpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRncmlkLmFwcGVuZCgkcm93KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyKCkge1xyXG4gICAgICAgIHRoaXMuaW5pdEdyaWQoKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgSGVyb2VzR3JpZENvbnRyb2xsZXIge1xyXG4gICAgX21vZGVsOiBIZXJvZXNHcmlkTW9kZWw7XHJcbiAgICBfdmlldzogSGVyb2VzR3JpZFZpZXc7XHJcblxyXG4gICAgY2xpY2s6IEZ1bmN0aW9uO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG1vZGVsOiBIZXJvZXNHcmlkTW9kZWwsIHZpZXc6IEhlcm9lc0dyaWRWaWV3KSB7XHJcbiAgICAgICAgdGhpcy5fbW9kZWwgPSBtb2RlbDtcclxuICAgICAgICB0aGlzLl92aWV3ID0gdmlldztcclxuXHJcbiAgICAgICAgdmlldy5vbignY2xpY2snLCAoaW5mbykgPT4gdGhpcy5jbGljayhpbmZvKSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBIZXJvZXNHcmlkIHsgXHJcbiAgICBtb2RlbCAgICAgID0gbmV3IEhlcm9lc0dyaWRNb2RlbCgpO1xyXG4gICAgdmlldyAgICAgICA9IG5ldyBIZXJvZXNHcmlkVmlldyh0aGlzLm1vZGVsKTtcclxuICAgIGNvbnRyb2xsZXIgPSBuZXcgSGVyb2VzR3JpZENvbnRyb2xsZXIodGhpcy5tb2RlbCwgdGhpcy52aWV3KTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihncmlkT3B0PzogR3JpZE9wdGlvbnMpIHtcclxuICAgICAgICBpZiAoZ3JpZE9wdCkge1xyXG4gICAgICAgICAgICBpZiAoZ3JpZE9wdC5wYXJlbnQpIHBhcmVudFNlbGVjdG9yID0gZ3JpZE9wdC5wYXJlbnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnZpZXcucmVuZGVyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb24oZXZlbnQ6IHN0cmluZywgY2FsbGJhY2s6IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5jb250cm9sbGVyW2V2ZW50XSA9IGNhbGxiYWNrO1xyXG4gICAgfVxyXG59Il19
